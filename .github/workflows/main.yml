name: Main

on:
  push:
    branches: [master, github-actions]

jobs:
  build:
    runs-on: windows-latest

    steps:
      - uses: actions/checkout@v2

      - uses: microsoft/setup-msbuild@v1.0.0

      - name: Bootstrap
        run: ./bootstrap.ps1
        shell: powershell

      - name: Build
        run: |
          $build = 5000 + $Env:GITHUB_RUN_NUMBER
          $dev = $true
          $genArtifacts = $true
          ./build-scripts/full.ps1 -buildNumber $build -generateArtifacts $genArtifacts -dev $dev
        shell: powershell
        env:
          CERT: ${{ secrets.CERT }}
          CERT_PASSWORD: ${{ secrets.CERT_PASSWORD }}
